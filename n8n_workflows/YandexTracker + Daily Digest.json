{
  "name": "YandexTracker + Daily Digest (—Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ë–î)",
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.body.user_role }}",
              "operation": "contains",
              "value2": "Team Lead"
            },
            {
              "value1": "={{ $json.body.user_role }}",
              "operation": "contains",
              "value2": "PM"
            }
          ]
        },
        "combineOperation": "any"
      },
      "id": "7e3f8a79-42de-4ad7-986d-c25e9d923e8d",
      "name": "–≠—Ç–æ TL –∏–ª–∏ PM?1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        3296,
        2128
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram –∑–∞–ø—Ä–æ—Å /digest').item.json.message.from.id }}",
        "text": "–î–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3504,
        2256
      ],
      "id": "30a8a7a4-2d59-46c6-aa97-7094b245454c",
      "name": "Send a text message1",
      "webhookId": "61e96e0d-0cdf-49bf-a20b-bf5289baf71f",
      "credentials": {
        "telegramApi": {
          "id": "GBA9u3UqZQvXbrXd",
          "name": "Assistant Daily Bot | @assistant_daily_ai_bot"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "==–¢—ã ‚Äî –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç scrum-–∫–æ–º–∞–Ω–¥—ã. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∑–∞–¥–∞—á–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ daily-–æ—Ç—á—ë—Ç–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞. –£—á–∏—Ç—ã–≤–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–ø—Ä–∏–Ω—Ç–∞: –æ–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å, —Ä–∏—Å–∫–∏ —Å—Ä—ã–≤–∞ —Å—Ä–æ–∫–æ–≤, –∑–∞–≥—Ä—É–∑–∫—É –∫–æ–º–∞–Ω–¥—ã.\n\n–î–∞–Ω–Ω—ã–µ –ø–æ –∑–∞–¥–∞—á–µ:\n–ö–ª—é—á –∑–∞–¥–∞—á–∏: {{ $json.taskKey }}\n–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: {{ $json.assignees[0].name }} ({{ $json.assignees[0].email }})\n\n–ò—Å—Ç–æ—Ä–∏—è daily (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏, –æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º):\n{{ JSON.stringify($json.dailyHistory.slice(0, 7), null, 2) }}\n\n–í—ã–ø–æ–ª–Ω–∏ –∞–Ω–∞–ª–∏–∑:\n1. –ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏, —á—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –≤—á–µ—Ä–∞ –∏ —á—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Å–µ–≥–æ–¥–Ω—è.\n2. –û—Ü–µ–Ω–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–¥–∞—á–∏ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (0‚Äì100%). –£—á–∏—Ç—ã–≤–∞–π:\n   - –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –ø–æ daily-–æ—Ç—á—ë—Ç–∞–º\n   - –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–∏–ø–∏—á–Ω–æ–π –∑–∞–¥–∞—á–∏ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ë–î ‚Äî –æ–±—ã—á–Ω–æ –±—ã—Å—Ç—Ä–æ; —Å–ª–æ–∂–Ω—ã–µ —Ñ–∏—á–∏ ‚Äî –º–µ–¥–ª–µ–Ω–Ω–µ–µ)\n   - –ù–∞–ª–∏—á–∏–µ –±–ª–æ–∫–µ—Ä–æ–≤ (—Å–Ω–∏–∂–∞—é—Ç –æ—Ü–µ–Ω–∫—É)\n   - –û–±—â–∏–π —Ç–µ–º–ø —Ä–∞–±–æ—Ç—ã –∏ –¥–µ–¥–ª–∞–π–Ω—ã —Å–ø—Ä–∏–Ω—Ç–∞\n3. –í—ã–¥–µ–ª–∏ –±–ª–æ–∫–µ—Ä—ã: –µ—Å—Ç—å –ª–∏, –Ω–∞—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã (–Ω–∏–∑–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è/–≤—ã—Å–æ–∫–∞—è), –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–ø—Ä–∏–Ω—Ç.\n4. –î–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: —á—Ç–æ —É—Ç–æ—á–Ω–∏—Ç—å —É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞, –Ω—É–∂–Ω–æ –ª–∏ —ç—Å–∫–∞–ª–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–º–ª–∏–¥—É/PM.\n\n–í—ã–≤–µ–¥–∏ —Å—Ç—Ä–æ–≥–æ –≤ Markdown, –∫–æ—Ä–æ—Ç–∫–æ (1‚Äì2 –º–∏–Ω—É—Ç—ã —á—Ç–µ–Ω–∏—è). –ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç:\n\n{{ $json.taskKey }} ({{ $json.assignees[0].name }})\n- **–ü—Ä–æ–≥—Ä–µ—Å—Å**: [–∫—Ä–∞—Ç–∫–æ: —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –≤—á–µ—Ä–∞ ‚Üí —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è]\n- **–û—Ü–µ–Ω–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: **XX%** (–æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: [–ø–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Å—Ç–æ–ª—å–∫–æ, –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–ø—Ä–∏–Ω—Ç])\n- **–ë–ª–æ–∫–µ—Ä—ã**: [–Ω–µ—Ç / –µ—Å—Ç—å: –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ + –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å]\n- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏–ª–∏ \"–≤—Å—ë –æ–∫, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º\"; –µ—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –≤—ã—Å–æ–∫–∞—è ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏ —ç—Å–∫–∞–ª–∞—Ü–∏—é]\n\n–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –Ω–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –æ—Ç—Å—Ç—É–ø–æ–≤ –∏–ª–∏ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –≤–Ω–µ —ç—Ç–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞.",
        "options": {
          "systemMessage": "",
          "maxIterations": 8,
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        4224,
        2080
      ],
      "id": "06855173-f319-4969-91ea-1b76721c59be",
      "name": "AI Agent1",
      "retryOnFail": true,
      "maxTries": 5,
      "alwaysOutputData": false,
      "waitBetweenTries": 5000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Webhook\"].json.body.chat_id }}",
        "text": "={{ $node[\"Format Report (Function)\"].json.report }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "5aff67fd-c5a2-419b-b144-e6cc1c939fde",
      "name": "Send Digest to Team1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        5280,
        1952
      ],
      "webhookId": "3e7fd052-cd53-4359-9ccd-522e3fa1218e",
      "credentials": {
        "telegramApi": {
          "id": "GBA9u3UqZQvXbrXd",
          "name": "Assistant Daily Bot | @assistant_daily_ai_bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $node[\"Format Report (Function)\"].json.report.includes('(—Ä–∏—Å–∫)') }}"
            }
          ]
        }
      },
      "id": "22735a29-6649-45b7-881d-73b1a564ee24",
      "name": "If Blockers Found1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        4976,
        1984
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Webhook\"].json.body.chat_id }}",
        "text": "üö® –ë–ª–æ–∫–µ—Ä—ã –≤ —Å–ø—Ä–∏–Ω—Ç–µ!\\n\\n{{ $node[\"Format Report (Function)\"].json.report }}",
        "additionalFields": {}
      },
      "id": "52b8a671-566b-4028-b4ee-475bdc9f3b65",
      "name": "Escalate to Team Lead1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        5280,
        2176
      ],
      "webhookId": "e983562d-38ed-44f1-a72b-3a1d12924d3d",
      "credentials": {
        "telegramApi": {
          "id": "GBA9u3UqZQvXbrXd",
          "name": "Assistant Daily Bot | @assistant_daily_ai_bot"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "d47fe292-a8f4-4147-9ebc-5ea1cf2e4857",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        3104,
        2128
      ],
      "id": "b991ff5a-f14a-436e-9943-888530d9bb4f",
      "name": "Webhook",
      "webhookId": "d47fe292-a8f4-4147-9ebc-5ea1cf2e4857"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.tracker.yandex.net/v3/issues/_search",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $json.iamToken }}"
            },
            {
              "name": "X-Cloud-Org-ID",
              "value": "–≤–∞—à id –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏"
            }
          ]
        },
        "options": {}
      },
      "id": "d3e141e8-7b66-48da-b76c-4b352172b658",
      "name": "Sprint Stats HTTP",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3680,
        1888
      ]
    },
    {
      "parameters": {
        "functionCode": "// items ‚Äî –º–∞—Å—Å–∏–≤ –∑–∞–¥–∞—á –∏–∑ HTTP Request\nconst tasks = items.map(item => item.json);\n\nif (tasks.length === 0) {\n  return [{\n    json: {\n      totalTasks: 0,\n      compl_inprogresTasks: 0,\n      completedTasks: 0,\n      inProgress: 0,\n      openTasks: 0,\n      progressPercent: 0\n    }\n  }];\n}\n\nconst totalTasks = tasks.length;\n\nlet completedTasks = 0;\nlet inProgress = 0;\nlet openTasks = 0;\n\nconst assignees = new Set();\n\ntasks.forEach(task => {\n  const statusId = task.statusType?.id?.toLowerCase();\n\n  if (statusId === 'done') {\n    completedTasks++;\n  }\n  else if (statusId === 'inprogress') {\n    inProgress++;\n  }\n  else if (statusId === 'new') {\n    openTasks++;\n  }\n\n  if (task.assignee?.id) {\n    assignees.add(task.assignee.id);\n  }\n});\n\n// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º compl_inprogresTasks –∫–∞–∫ —Å—É–º–º—É inProgress –∏ openTasks\nconst compl_inprogresTasks = inProgress + openTasks;\n\n// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\nconst progressPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;\n\nreturn [{\n  json: {\n    totalTasks,\n    compl_inprogresTasks,\n    completedTasks,\n    inProgress,\n    openTasks,\n    progressPercent\n  }\n}];"
      },
      "id": "884c5f6d-b5ee-45c7-867c-88f9c4461fae",
      "name": "Calculate Sprint Stats",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        3888,
        1888
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://iam.api.cloud.yandex.net/iam/v1/tokens",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "yandexPassportOauthToken",
              "value": "–≤–∞—à id –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —è–Ω–¥–µ–∫—Å"
            }
          ]
        },
        "options": {}
      },
      "name": "Auth Yandex",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        3504,
        1888
      ],
      "id": "4d73e4c3-248b-41f1-aafe-9594ee4dbc47"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT\n    c.id AS checkin_id,\n    c.user_id,\n    c.checkin_date,\n    c.answer_yesterday,\n    c.answer_today,\n    c.answer_blockers,\n    c.task_id,\n\n    u.id AS user_id,\n    u.chat_id,\n    u.name,\n    u.is_daily_participant,\n    u.email,\n    u.tracker_user_id,\n    u.current_task_key,\n    u.daily_active\nFROM public.checkins c\nJOIN public.users u\n    ON c.user_id = u.id\nWHERE u.daily_active = true;\n",
        "options": {}
      },
      "name": "–î–∞–Ω–Ω—ã–µ –æ daily –∏–∑ –ë–î1",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        3616,
        2112
      ],
      "id": "bf6a7c1d-e1f5-4212-abd1-3c2b64e131c5",
      "credentials": {
        "postgres": {
          "id": "hwvrIUikD9aId72o",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "model": "deepseek/deepseek-r1-0528:free",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        4192,
        2304
      ],
      "id": "eca06034-3509-45ab-bd0e-3981345b7fbd",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "MstKlLVXE7R5Vn5L",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –í—Ö–æ–¥: –º–∞—Å—Å–∏–≤ items –∏–∑ Postgres (–∫–∞–∂–¥—ã–π ‚Äî –æ–¥–∏–Ω check-in)\n\n// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ task_id (–∏–ª–∏ current_task_key)\nconst tasksMap = {};\n\nitems.forEach(item => {\n  const data = item.json;\n  const taskKey = data.task_id || data.current_task_key || 'UNKNOWN';\n\n  if (!tasksMap[taskKey]) {\n    tasksMap[taskKey] = {\n      taskKey: taskKey,\n      assignees: new Set(),\n      dailyHistory: []\n    };\n  }\n\n  // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ, –Ω–æ —Ä–µ–¥–∫–æ)\n  if (data.name && data.email) {\n    tasksMap[taskKey].assignees.add(JSON.stringify({\n      name: data.name,\n      email: data.email\n    }));\n  }\n\n  // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –∫—Ä–∞—Å–∏–≤–æ\n  const dateStr = data.checkin_date \n    ? new Date(data.checkin_date).toLocaleDateString('ru-RU')\n    : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';\n\n  // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é\n  tasksMap[taskKey].dailyHistory.push({\n    date: dateStr,\n    yesterday: data.answer_yesterday || '‚Äî',\n    today: data.answer_today || '‚Äî',\n    blockers: data.answer_blockers || '–ù–µ—Ç –±–ª–æ–∫–µ—Ä–æ–≤'\n  });\n});\n\n// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º Set –∞—Å—Åignees –≤ –º–∞—Å—Å–∏–≤\nObject.values(tasksMap).forEach(task => {\n  task.assignees = Array.from(task.assignees).map(str => JSON.parse(str));\n  // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)\n  task.dailyHistory.sort((a, b) => {\n    const da = new Date(a.date.split('.').reverse().join('-'));\n    const db = new Date(b.date.split('.').reverse().join('-'));\n    return db - da;\n  });\n});\n\n// –í—ã–≤–æ–¥–∏–º –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ ‚Äî –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∑–∞–¥–∞—á—É\nreturn Object.values(tasksMap).map(task => ({\n  json: task\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3856,
        2112
      ],
      "id": "1025f706-97d5-4486-8c60-4aaf116b3034",
      "name": "–í—Å–µ daily –æ–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–∫—É—â–∏–º –∑–∞–¥–∞—á–∞–º"
    },
    {
      "parameters": {
        "functionCode": "// –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö\nif (items.length === 0) {\n  return [{ json: { report: \"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ —Å–µ–≥–æ–¥–Ω—è.\" } }];\n}\n\n// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Äî –ø–µ—Ä–≤—ã–π item\nlet statsItem = items[0].json;\nlet aiItems = items.slice(1); // –æ—Ç—á—ë—Ç—ã –ò–ò\n\nlet stats = {\n  totalTasks: 0,\n  completedTasks: 0,\n  inProgress: 0,\n  openTasks: 0,\n  totalMembers: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',\n  progressPercent: 0,\n  compl_inprogresTasks: 0  // –Ω–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä\n};\n\nif (typeof statsItem.totalTasks === 'number') {\n  stats = {\n    totalTasks: statsItem.totalTasks || 0,\n    completedTasks: statsItem.completedTasks || 0,\n    inProgress: statsItem.inProgress || 0,\n    openTasks: statsItem.openTasks || 0,\n    totalMembers: statsItem.totalMembers || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',\n    progressPercent: statsItem.totalTasks > 0 \n      ? Math.round((statsItem.completedTasks / statsItem.totalTasks) * 100)\n      : 0,\n    compl_inprogresTasks: (statsItem.openTasks || 0) + (statsItem.inProgress || 0)  // —Å—É–º–º–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö + –≤ —Ä–∞–±–æ—Ç–µ\n  };\n}\n\n// –°–æ–±–∏—Ä–∞–µ–º –æ—Ç—á—ë—Ç—ã –æ—Ç –ò–ò\nconst taskReports = aiItems\n  .map(item => {\n    const output = item.json.output || item.json.text || \"\";\n    if (!output.trim()) return null;\n\n    const keyMatch = output.match(/###\\s+([A-Z]+-\\d+)/);\n    const taskKey = keyMatch ? keyMatch[1] : 'UNKNOWN';\n\n    const percentMatch = output.match(/\\*\\*–û—Ü–µ–Ω–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è\\*\\*:\\s*\\*\\*(\\d+)%\\*\\*/);\n    const percent = percentMatch ? percentMatch[1] : '?';\n\n    const modifiedOutput = output.replace(\n      /###\\s+[A-Z]+-\\d+/,\n      `### ${taskKey} ‚Äî ${percent}% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ`\n    );\n\n    return modifiedOutput.trim();\n  })\n  .filter(Boolean)\n  .join(\"\\n\\n---\\n\\n\");\n\nconst reportsSection = taskReports || \"_–ù–µ—Ç –æ—Ç—á—ë—Ç–æ–≤ –ø–æ –∑–∞–¥–∞—á–∞–º –≤ —Ä–∞–±–æ—Ç–µ_\";\n\n// –ë–ª–æ–∫–µ—Ä—ã\nconst allBlockers = [];\naiItems.forEach(item => {\n  const text = (item.json.output || item.json.text || \"\");\n  const lines = text.split('\\n');\n  lines.forEach(line => {\n    if (line.toLowerCase().includes('–±–ª–æ–∫–µ—Ä') && line.includes(':')) {\n      allBlockers.push(line.trim());\n    }\n  });\n});\n\nconst risksSection = allBlockers.length > 0\n  ? `–û–±—â–∏–µ —Ä–∏—Å–∫–∏ –∏ –±–ª–æ–∫–µ—Ä—ã\\n${allBlockers.map(b => `- ${b}`).join('\\n')}\\n`\n  : '–û–±—â–∏–µ —Ä–∏—Å–∫–∏ –∏ –±–ª–æ–∫–µ—Ä—ã\\n–ö—Ä–∏—Ç–∏—á–Ω—ã—Ö –±–ª–æ–∫–µ—Ä–æ–≤ –Ω–µ –≤—ã—è–≤–ª–µ–Ω–æ.';\n\nconst fullReport = `–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –¥–∞–π–¥–∂–µ—Å—Ç –ø–æ –∑–∞–¥–∞—á–∞–º\n\n**–î–∞—Ç–∞:** ${new Date().toLocaleDateString('ru-RU')}\n**–ó–∞–¥–∞—á –≤ —Ä–∞–±–æ—Ç–µ:** ${stats.inProgress} –∏–∑ ${stats.compl_inprogresTasks}\n\n–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–ø—Ä–∏–Ω—Ç–∞\n- –í—Å–µ–≥–æ –∑–∞–¥–∞—á –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ: **${stats.totalTasks}**\n- –í—ã–ø–æ–ª–Ω–µ–Ω–æ: **${stats.completedTasks}** (${stats.progressPercent}%)\n- –í —Ä–∞–±–æ—Ç–µ: **${stats.inProgress}**\n- –ù–æ–≤—ã–µ/–æ—Ç–∫—Ä—ã—Ç—ã–µ: **${stats.openTasks}**\n- –ù–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –≤—Å–µ–≥–æ: **${stats.compl_inprogresTasks}**\n\n${risksSection}\n\n–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∑–∞–¥–∞—á–∞–º\n\n${reportsSection}\n\n---\n–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º.`;\n\nreturn [{ json: { report: fullReport } }];"
      },
      "id": "89974992-0f7a-4af3-acb0-6b0e0275f6ed",
      "name": "Format Report (Function)",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        4768,
        1984
      ]
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        4544,
        1984
      ],
      "id": "4ef82300-f159-41b1-98c5-d1f79404be42",
      "name": "Merge"
    }
  ],
  "pinData": {},
  "connections": {
    "–≠—Ç–æ TL –∏–ª–∏ PM?1": {
      "main": [
        [
          {
            "node": "Auth Yandex",
            "type": "main",
            "index": 0
          },
          {
            "node": "–î–∞–Ω–Ω—ã–µ –æ daily –∏–∑ –ë–î1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Blockers Found1": {
      "main": [
        [
          {
            "node": "Escalate to Team Lead1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Digest to Team1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "–≠—Ç–æ TL –∏–ª–∏ PM?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sprint Stats HTTP": {
      "main": [
        [
          {
            "node": "Calculate Sprint Stats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Auth Yandex": {
      "main": [
        [
          {
            "node": "Sprint Stats HTTP",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate Sprint Stats": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "–î–∞–Ω–Ω—ã–µ –æ daily –∏–∑ –ë–î1": {
      "main": [
        [
          {
            "node": "–í—Å–µ daily –æ–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–∫—É—â–∏–º –∑–∞–¥–∞—á–∞–º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–í—Å–µ daily –æ–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–∫—É—â–∏–º –∑–∞–¥–∞—á–∞–º": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Report (Function)": {
      "main": [
        [
          {
            "node": "If Blockers Found1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Format Report (Function)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ed46fe75-898e-4966-9684-c271ff1697ab",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "4335b01868eb37f935a786299dedc4e5da652ac2583b1ec0f3aaeb003d539169"
  },
  "id": "XkbRNY98WTWR5iJo",
  "tags": []
}